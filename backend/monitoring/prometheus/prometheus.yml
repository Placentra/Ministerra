global:
    scrape_interval: 15s
    evaluation_interval: 30s

rule_files:
    - /etc/prometheus/alerts/*.yml
    - /etc/prometheus/alerts/*.yaml

scrape_configs:
    - job_name: 'prometheus'
      static_configs:
          - targets: ['prometheus:9090']

    - job_name: 'traefik'
      static_configs:
          - targets: ['traefik:8080']
      metrics_path: /metrics

    - job_name: 'node'
      static_configs:
          - targets: ['node-exporter:9100']

    - job_name: 'cadvisor'
      static_configs:
          - targets: ['cadvisor:8080']

    - job_name: 'redis'
      static_configs:
          - targets: ['redis-exporter:9121']

    - job_name: 'mysql'
      static_configs:
          - targets: ['mysqld-exporter:9104']

    - job_name: 'blackbox'
      metrics_path: /probe
      params:
          module: [http_2xx]
      static_configs:
          - targets:
                - http://host.docker.internal:3000
                - http://host.docker.internal:8080
      relabel_configs:
          - source_labels: [__address__]
            target_label: __param_target
          - source_labels: [__param_target]
            target_label: instance
          - target_label: __address__
            replacement: blackbox-exporter:9115

    - job_name: 'otel-collector'
      static_configs:
          - targets: ['otel-collector:8889']

    - job_name: 'backend-app'
      metrics_path: /metrics
      static_configs:
          - targets: ['backend:9464', 'backend-app:9464']
      authorization:
          type: Bearer
          credentials_file: /etc/prometheus/secrets/metrics_token
      scheme: http

    # Removed redundant worker scrape; backend exposes /metrics for app-level metrics
